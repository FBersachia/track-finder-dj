{% extends 'base.html' %}

{% block content %}
    <h1>{% if song %}Editar Canción{% else %}Añadir Nueva Canción{% endif %}</h1>

    <form method="post" action="{{ url_for('main.edit_song', id=song.id_cancion) if song else url_for('main.add_song') }}">
        <div>
            <label for="nombre">Nombre de la Canción (requerido):</label>
            <input type="text" id="nombre" name="nombre" required value="{{ song.nombre or '' }}">
        </div>
        <br>
        <div>
            <label for="artista_principal_id">Artista Principal (requerido):</label>
            <select name="artista_principal_id" id="artista_principal_id" required>
                <option value="">Selecciona un artista</option>
                {% for artista in artistas %}
                    <option value="{{ artista.id_artista }}" {% if song and song.artista_principal_id == artista.id_artista %}selected{% endif %}>
                        {{ artista.nombre }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <br>
        <div>
            <label for="ubicacion">Ubicación del Archivo (requerido):</label>
            <input type="text" id="ubicacion" name="ubicacion" required style="width: 400px;" value="{{ song.ubicacion or '' }}">
        </div>
        <br>
        <hr>
        <h3>Datos Opcionales</h3>
        <div>
            <label for="año">Año:</label>
            <input type="number" id="año" name="año" value="{{ song.año or '' }}">
        </div>
        <br>
        <div>
            <label for="sub_genero_id">Subgénero:</label>
            <select name="sub_genero_id" id="sub_genero_id">
                <option value="">Selecciona un subgénero</option>
                {% for sub_genero in sub_generos %}
                    <option value="{{ sub_genero.id_sub_genero }}" {% if song and song.sub_genero_id == sub_genero.id_sub_genero %}selected{% endif %}>
                        {{ sub_genero.main_genero.nombre }} - {{ sub_genero.nombre }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <br>
        <div>
            <label for="mood_id">Mood:</label>
            <select name="mood_id" id="mood_id">
                <option value="">Selecciona un mood</option>
                {% for mood in moods %}
                    <option value="{{ mood.id_mood }}" {% if song and song.mood_id == mood.id_mood %}selected{% endif %}>
                        {{ mood.nombre }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <br>
        <div>
            <label for="featuring_ids">Artistas en Colaboración (Ctrl+Click para varios):</label>
            <select name="featuring_ids" id="featuring_ids" multiple style="height: 150px;">
                {% set featuring_ids = song.artistas_featuring | map(attribute='id_artista') | list %}
                {% for artista in artistas %}
                    <option value="{{ artista.id_artista }}" {% if song and artista.id_artista in featuring_ids %}selected{% endif %}>
                        {{ artista.nombre }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <br>
        <div>
            <label for="keywords">Palabras Clave (separadas por coma):</label>
            <input type="text" id="keywords" name="keywords" style="width: 400px;" value="{{ song.keywords or '' }}">
        </div>
        <br>
        <button type="submit">Guardar Cambios</button>
    </form>
{% endblock %}